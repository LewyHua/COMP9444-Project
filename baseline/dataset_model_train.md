# MPST数据集清洗与模型训练流程

## 一、数据集清洗流程

MPST数据集（Movie Plot Synopses with Tags）是一个包含电影剧情简介和标签的数据集，其清洗过程如下：

### 1. 文本基础清理

在`clean_text`函数中进行以下处理：
- **移除HTML标签**：使用正则表达式去除所有HTML标签
- **处理HTML实体**：将HTML实体（如`&amp;`）转换为对应的字符
- **替换URL**：将所有URL替换为`[URL]`标记
- **过滤非标准字符**：只保留字母、数字、空格和基本标点符号
- **规范化空白**：将多个连续空格替换为单个空格

### 2. 文本深度预处理

在`preprocess_text`函数中进行以下处理：
- **转换为小写**：将所有文本转换为小写形式
- **分词**：使用NLTK的`word_tokenize`函数将文本分割为单词
- **移除停用词**：去除常见的英文停用词（如"the"、"a"、"is"等）
- **词形还原**：使用NLTK的`WordNetLemmatizer`将词转换为其基本形式
- **连接处理后的词**：将处理后的词重新连接为文本

### 3. 标签处理

在`process_tags`函数中进行以下处理：
- **标签标准化**：
  - 将标签转换为小写
  - 应用映射表修正不一致的标签（如"sci-fi"→"science fiction"）
  - 处理组合标签（如"drama/comedy"→"drama,comedy"）
  - 移除重复标签
- **标签筛选**：
  - 统计所有标签的出现频率
  - 选择出现频率超过阈值（默认50次）的标签作为有效标签
  - 对每个有效标签创建二值特征列

### 4. 数据集划分

根据官方提供的训练集和测试集ID列表划分数据：
- 将官方测试集进一步划分为验证集和测试集（原始测试集的45%用于验证，55%用于测试）
- 最终划分比例约为训练集64%、验证集16%、测试集20%

### 5. 特征提取

为机器学习模型准备TF-IDF特征：
- 使用TF-IDF向量器提取文本特征
- 设置参数：最大特征数5000，移除出现在超过95%文档中的词
- 分别为训练集、验证集和测试集生成特征矩阵

### 6. 数据保存

最终保存以下处理后的数据：
- 完整处理后的数据集（`processed_full_data.csv`）
- 划分后的训练集、验证集和测试集
- 有效标签列表（`valid_tags.json`）
- 处理统计信息（`processing_stats.json`）
- TF-IDF特征矩阵和向量器

## 二、BiLSTM模型训练流程

基于"MPST: A Corpus of Movie Plot Synopses with Tags"论文，我们实现了BiLSTM模型作为baseline：

### 1. 模型架构

模型实现在`train_bilstm_classifier.py`文件中，包含以下组件：

- **词嵌入层**：
  - 将词转换为300维的词向量
  - 使用填充索引0处理可变长度序列

- **双向LSTM层**：
  - 2层BiLSTM结构
  - 隐藏层维度为128
  - 应用dropout (0.5)防止过拟合

- **注意力机制**：
  - 为序列中的每个词分配权重
  - 计算加权上下文向量

- **全连接层**：
  - 将上下文向量映射到隐藏层
  - 最后一层输出68个标签的预测

### 2. 训练参数

- **批量大小**：32
- **序列长度**：限制为300个词
- **学习率**：0.001
- **优化器**：Adam，带L2正则化（权重衰减1e-5）
- **损失函数**：带正样本权重的二元交叉熵（处理类别不平衡）
- **早停机制**：验证集F1不再提高时停止训练（耐心值5）
- **最大训练轮次**：50

### 3. 模型评估

模型使用以下指标进行评估：
- **精确率**（Precision）：正确预测的标签占所有预测为正的标签的比例
- **召回率**（Recall）：正确预测的标签占所有实际为正的标签的比例
- **F1分数**（F1-score）：精确率和召回率的调和平均值

### 4. 训练结果

在MPST数据集上，BiLSTM模型的表现如下：

- **验证集**：
  - 精确率：约40.16%
  - 召回率：约17.85%
  - F1值：约24.72%

- **测试集**：
  - 精确率：约40.82%
  - 召回率：约17.40%
  - F1值：约24.40%

- **标签性能分析**：
  - 表现最好的标签："murder"（F1=56.68%）、"violence"（F1=46.86%）
  - 许多低频标签的F1值为0，表明模型对这些标签的预测能力不佳

### 5. 模型文件

训练后保存的文件包括：
- 模型参数文件（`bilstm_model.pt`）
- 词汇表文件（`bilstm_vocab.json`）
- 评估结果（`bilstm_results.json`）
- 性能可视化图表（`bilstm_top_tags_performance.png`、`bilstm_loss_curve.png`）

## 三、结论与改进方向

- 当前的BiLSTM模型作为baseline提供了基础性能，但仍有较大的改进空间
- 模型在高频标签上表现较好，但在低频标签上表现较差
- 可考虑使用预训练词嵌入、更复杂的模型架构或数据增强等技术进一步提升性能
